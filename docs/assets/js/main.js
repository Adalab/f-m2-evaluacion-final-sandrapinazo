"use strict";const inputEl=document.querySelector("#TVshow"),buttonEl=document.querySelector(".button"),ulfavEl=document.querySelector(".favs"),ulresultsEl=document.querySelector(".results"),deleteAllBtnEl=document.querySelector(".button__delete--all");let favList=[];function btnClickHandler(){ulresultsEl.innerHTML="";const t=inputEl.value;fetch(`http://api.tvmaze.com/search/shows?q=${t}`).then(t=>t.json()).then(function(t){for(const e of t){const{show:t}=e,{id:s,name:a,image:n}=t,l=document.createElement("li");l.classList.add("show"),l.setAttribute("data-id",s);const i=document.createElement("p"),o=document.createTextNode(a);i.classList.add("title"),i.appendChild(o);const c=document.createElement("img");c.classList.add("image"),imageOrPlaceholder(n,c),addFavClassIfInFavList(l,s),l.appendChild(c),l.appendChild(i),l.addEventListener("click",favShow),ulresultsEl.appendChild(l)}})}function imageOrPlaceholder(t,e){if(t){const{medium:s}=t;e.src=s}else e.src="https://via.placeholder.com/210x295/ffffff/666666/?text=TV"}function addFavClassIfInFavList(t,e){for(let s=0;s<favList.length;s++)parseInt(favList[s].id)===e&&t.classList.add("favshow")}function favShow(t){const e=t.currentTarget;e.classList.toggle("favshow");const s=e.querySelector("p").innerHTML,a=e.querySelector("img").src,n=e.getAttribute("data-id");toggleShowFromFavList(e,{id:n,title:s,img:a},n),paintFavList(),saveFavs()}function toggleShowFromFavList(t,e,s){if(t.classList.contains("favshow"))favList.push(e);else for(let t=0;t<favList.length;t++)favList[t].id===s&&favList.splice(t,1)}function paintFavList(){ulfavEl.innerHTML="";for(const t of favList){const{id:e,title:s,img:a}=t,n=`\n    <li class="show" data-id="${e}">\n        <img src= ${a} alt=${s} class="image">\n        <p class="title">${s}</p>\n        <button class="delete" type="button">X</button>\n    </li>`;ulfavEl.innerHTML+=n}listenersForAllElements(ulfavEl.querySelectorAll(".delete"))}function listenersForAllElements(t){for(const e of t)e.addEventListener("click",deleteWithFavBtn)}function saveFavs(){localStorage.setItem("favShowsList",JSON.stringify(favList))}function setfavListFromCache(){const t=JSON.parse(localStorage.getItem("favShowsList"));t&&(favList=t,paintFavList())}function deleteWithFavBtn(t){deleteFavShow(t.currentTarget.parentElement.getAttribute("data-id")),paintFavList(),saveFavs()}function deleteFavShow(t){for(let e=0;e<favList.length;e++)favList[e].id===t&&favList.splice(e,1)}function searchEnter(t){"Enter"===t.key&&btnClickHandler()}function deleteAllFavs(){favList=[],paintFavList(),saveFavs()}setfavListFromCache(),buttonEl.addEventListener("click",btnClickHandler),inputEl.addEventListener("keyup",searchEnter),deleteAllBtnEl.addEventListener("click",deleteAllFavs);