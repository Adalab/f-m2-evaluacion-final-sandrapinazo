"use strict";const inputEl=document.querySelector("#TVshow"),buttonEl=document.querySelector(".button"),ulfavEl=document.querySelector(".favs"),ulresultsEl=document.querySelector(".results"),deleteAllBtnEl=document.querySelector(".button__delete--all");let favList=[];function handlerBtnClick(){ulresultsEl.innerHTML="";const t=inputEl.value;fetch(`http://api.tvmaze.com/search/shows?q=${t}`).then(t=>t.json()).then(function(t){for(const e of t){const{show:t}=e,{id:a,name:n,image:s}=t,l=document.createElement("li");l.classList.add("show"),l.setAttribute("data-id",a);const i=document.createElement("p"),o=document.createTextNode(n);i.classList.add("title"),i.appendChild(o);const r=document.createElement("img");r.classList.add("image"),imageOrPlaceholder(s,r),addFavClassIfInFavList(l,a),l.appendChild(r),l.appendChild(i),l.addEventListener("click",favShow),ulresultsEl.appendChild(l)}})}function imageOrPlaceholder(t,e){if(t){const{medium:a}=t;e.src=a}else e.src="https://via.placeholder.com/210x295/ffffff/666666/?text=TV"}function addFavClassIfInFavList(t,e){for(let a=0;a<favList.length;a++)parseInt(favList[a].id)===e&&t.classList.add("favshow")}function favShow(t){const e=t.currentTarget;e.classList.toggle("favshow");const a=e.querySelector("p").innerHTML,n=e.querySelector("img").src,s=e.getAttribute("data-id");toggleShowFromFavList(e,{id:s,title:a,img:n},s),paintFavList(),saveFavs(),noFavsHandler()}function toggleShowFromFavList(t,e,a){if(t.classList.contains("favshow"))favList.push(e);else for(let t=0;t<favList.length;t++)favList[t].id===a&&favList.splice(t,1)}function paintFavList(){ulfavEl.innerHTML="";for(const t of favList){const{id:e,title:a,img:n}=t,s=`\n    <li class="show" data-id="${e}">\n        <img src= ${n} alt=${a} class="image">\n        <p class="title">${a}</p>\n        <button class="delete" type="button">X</button>\n    </li>`;ulfavEl.innerHTML+=s}listenersForAllElements(ulfavEl.querySelectorAll(".delete"))}function listenersForAllElements(t){for(const e of t)e.addEventListener("click",handlerDeleteWithFavBtn)}function saveFavs(){localStorage.setItem("favShowsList",JSON.stringify(favList))}function setfavListFromCache(){const t=JSON.parse(localStorage.getItem("favShowsList"));t&&(favList=t,paintFavList())}function handlerDeleteWithFavBtn(t){deleteFavShow(t.currentTarget.parentElement.getAttribute("data-id")),paintFavList(),saveFavs(),noFavsHandler()}function deleteFavShow(t){for(let e=0;e<favList.length;e++)favList[e].id===t&&favList.splice(e,1)}function handlerEnter(t){"Enter"===t.key&&handlerBtnClick()}function handlerdeleteAllFavs(){favList=[],paintFavList(),saveFavs(),noFavsHandler()}function noFavsHandler(){0===favList.length&&(ulfavEl.innerHTML='<p class="no-favs">No hay favoritos.</p>',localStorage.removeItem("favShowsList"))}setfavListFromCache(),noFavsHandler(),buttonEl.addEventListener("click",handlerBtnClick),inputEl.addEventListener("keyup",handlerEnter),deleteAllBtnEl.addEventListener("click",handlerdeleteAllFavs);